/**
 * Trumbowyg v2.0.0-beta.5 - A lightweight WYSIWYG editor
 * Trumbowyg core file
 * ------------------------
 * @link http://alex-d.github.io/Trumbowyg
 * @license MIT
 * @author Alexandre Demode (Alex-D)
 *         Twitter : @AlexandreDemode
 *         Website : alex-d.fr
 */
jQuery.trumbowyg={langs:{en:{viewHTML:"View HTML",formatting:"Formatting",p:"Paragraph",blockquote:"Quote",code:"Code",header:"Header",bold:"Bold",italic:"Italic",strikethrough:"Stroke",underline:"Underline",strong:"Strong",em:"Emphasis",del:"Deleted",unorderedList:"Unordered list",orderedList:"Ordered list",insertImage:"Insert Image",insertVideo:"Insert Video",link:"Link",createLink:"Insert link",unlink:"Remove link",justifyLeft:"Align Left",justifyCenter:"Align Center",justifyRight:"Align Right",justifyFull:"Align Justify",horizontalRule:"Insert horizontal rule",removeformat:"Remove format",fullscreen:"fullscreen",close:"Close",submit:"Confirm",reset:"Cancel",required:"Required",description:"Description",title:"Title",text:"Text",target:"Target"}},opts:{},btnsGrps:{design:["bold","italic","underline","strikethrough"],semantic:["strong","em","del"],justify:["justifyLeft","justifyCenter","justifyRight","justifyFull"],lists:["unorderedList","orderedList"]}},function(n,t,i,r,u){"use strict";r.fn.trumbowyg=function(n,t){if(n===Object(n)||!n)return this.each(function(){r(this).data("trumbowyg")||r(this).data("trumbowyg",new f(this,n))});if(this.length===1)try{var i=r(this).data("trumbowyg");switch(n){case"openModal":return i.openModal(t.title,t.content);case"closeModal":return i.closeModal();case"openModalInsert":return i.openModalInsert(t.title,t.fields,t.callback);case"saveSelection":return i.saveSelection();case"getSelection":return i.selection;case"getSelectedText":return i.getSelectedText();case"restoreSelection":return i.restoreSelection();case"destroy":return i.destroy();case"empty":return i.empty();case"lang":return i.lang;case"html":return i.html(t)}}catch(u){}return!1};var f=function(n,t){var u=this,f;u.doc=n.ownerDocument||i;u.$ta=r(n);u.$c=r(n);t=r.extend(!0,{},t,r.trumbowyg.opts);u.lang=typeof t.lang=="undefined"||typeof r.trumbowyg.langs[t.lang]=="undefined"?r.trumbowyg.langs.en:r.extend(!0,{},r.trumbowyg.langs.en,r.trumbowyg.langs[t.lang]);f=u.lang.header;u.o=r.extend(!0,{},{lang:"en",dir:"ltr",closable:!1,fullscreenable:!0,fixedBtnPane:!1,fixedFullWidth:!1,autogrow:!1,prefix:"trumbowyg-",semantic:!0,resetCss:!1,removeformatPasted:!1,tagsToRemove:[],btns:["viewHTML","|","formatting","|","btnGrp-design","|","link","|","insertImage","|","btnGrp-justify","|","btnGrp-lists","|","horizontalRule","|","removeformat"],btnsAdd:[],btnsDef:{viewHTML:{func:"toggle"},p:{func:"formatBlock"},blockquote:{func:"formatBlock"},h1:{func:"formatBlock",title:f+" 1"},h2:{func:"formatBlock",title:f+" 2"},h3:{func:"formatBlock",title:f+" 3"},h4:{func:"formatBlock",title:f+" 4"},bold:{key:"B"},italic:{key:"I"},underline:{},strikethrough:{},strong:{func:"bold",key:"B"},em:{func:"italic",key:"I"},del:{func:"strikethrough"},createLink:{key:"K"},unlink:{},insertImage:{},justifyLeft:{},justifyCenter:{},justifyRight:{},justifyFull:{},unorderedList:{func:"insertUnorderedList"},orderedList:{func:"insertOrderedList"},horizontalRule:{func:"insertHorizontalRule"},removeformat:{},formatting:{dropdown:["p","blockquote","h1","h2","h3","h4"]},link:{dropdown:["createLink","unlink"]}},inlineElementsSelector:"a, abbr, acronym, b, caption, cite, code, col, dfn, dir, dt, dd, em, font, hr, i, kbd, li, q, span, strikeout, strong, sub, sup, u"},t);t.btns?u.o.btns=t.btns:u.o.semantic&&(u.o.btns[4]="btnGrp-semantic");u.keys=[];u.init()};f.prototype={init:function(){var n=this;n.height=n.$ta.height();n.buildEditor();n.buildBtnPane();n.fixedBtnPaneEvents();n.buildOverlay()},buildEditor:function(){var n=this,u=n.o.prefix,f="";n.$box=r("<div/>",{"class":u+"box "+u+"editor-visible "+u+n.o.lang+" trumbowyg"});n.isTextarea=n.$ta.is("textarea");n.isTextarea?(f=n.$ta.val(),n.$ed=r("<div/>"),n.$box.insertAfter(n.$ta).append(n.$ed,n.$ta)):(n.$ed=n.$ta,f=n.$ed.html(),n.$ta=r("<textarea/>",{name:n.$ta.attr("id"),height:n.height}).val(f),n.$box.insertAfter(n.$ed).append(n.$ta,n.$ed),n.syncCode());n.$ta.addClass(u+"textarea").attr("tabindex",-1);n.$ed.addClass(u+"editor").attr({contenteditable:!0,dir:n.lang._dir||n.o.dir}).html(f);n.o.tabindex&&n.$ed.attr("tabindex",n.o.tabindex);n.$c.is("[placeholder]")&&n.$ed.attr("placeholder",n.$c.attr("placeholder"));n.o.resetCss&&n.$ed.addClass(u+"reset-css");n.o.autogrow||n.$ta.add(n.$ed).css({height:n.height});n.semanticCode();n._ctrl=!1;n.$ed.on("dblclick","img",function(){var t=r(this);return n.openModalInsert(n.lang.insertImage,{url:{label:"URL",value:t.attr("src"),required:!0},alt:{label:n.lang.description,value:t.attr("alt")}},function(n){return t.attr({src:n.url,alt:n.alt})}),!1}).on("keydown",function(t){if(n._composition=t.which===229,t.ctrlKey){n._ctrl=!0;var i=n.keys[String.fromCharCode(t.which).toUpperCase()];try{return n.execCmd(i.func,i.param),!1}catch(t){}}}).on("keyup",function(t){n._ctrl||t.which===17||n._composition||(n.semanticCode(!1,t.which===13),n.$c.trigger("tbwchange"));setTimeout(function(){n._ctrl=!1},200)}).on("focus blur",function(t){n.$c.trigger("tbw"+t.type)}).on("paste",function(r){if(n.o.removeformatPasted){r.preventDefault();try{var u=t.clipboardData.getData("Text");try{n.doc.selection.createRange().pasteHTML(u)}catch(f){n.doc.getSelection().getRangeAt(0).insertNode(i.createTextNode(u))}}catch(f){n.execCmd("insertText",(r.originalEvent||r).clipboardData.getData("text/plain"))}}setTimeout(function(){n.o.semantic?n.semanticCode(!1,!0):n.syncCode();n.$c.trigger("tbwpaste",r)},0)});n.$ta.on("keyup paste",function(){n.$c.trigger("tbwchange")});r(n.doc).on("keydown",function(t){if(t.which===27)return n.closeModal(),!1})},buildBtnPane:function(){var n=this,i=n.o.prefix,f;n.o.btns!==!1&&(n.$btnPane=r("<ul/>",{"class":i+"button-pane"}),r.each(n.o.btns.concat(n.o.btnsAdd),function(t,f){try{var e=f.split("btnGrp-");e[1]!==u&&(f=r.trumbowyg.btnsGrps[e[1]])}catch(o){}r.isArray(f)||(f=[f]);r.each(f,function(t,u){try{var f=r("<li/>");u==="|"?f.addClass(i+"separator"):n.isSupportedBtn(u)&&f.append(n.buildBtn(u));n.$btnPane.append(f)}catch(e){}})}),f=r("<li/>",{"class":i+"not-disable "+i+"buttons-right"}),n.o.fullscreenable&&f.append(n.buildRightBtn("fullscreen").on("click",function(){var u=i+"fullscreen";n.$box.toggleClass(u);r("body").toggleClass(i+"body-fullscreen",n.$box.hasClass(u));r(t).trigger("scroll")})),n.o.closable&&f.append(n.buildRightBtn("close").on("click",function(){n.$box.removeClass(i+"fullscreen");n.destroy();n.$c.trigger("tbwclose")})),f.not(":empty")&&n.$btnPane.append(f),n.$box.prepend(n.$btnPane))},buildBtn:function(n){var i=this,u=i.o.prefix,t=i.o.btnsDef[n],f=t.dropdown,s=i.lang[n]||n,h=r("<button/>",{type:"button","class":u+n+"-button"+(t.ico?" "+u+t.ico+"-button":""),text:t.text||t.title||s,title:t.title||t.text||s+(t.key?" (Ctrl + "+t.key+")":""),tabindex:-1,mousedown:function(){return((!f||r("."+n+"-"+u+"dropdown",i.$box).is(":hidden"))&&r("body",i.doc).trigger("mousedown"),i.$btnPane.hasClass(u+"disable")&&!r(this).hasClass(u+"active")&&!r(this).parent().hasClass(u+"not-disable"))?!1:(i.execCmd((f?"dropdown":!1)||t.func||n,t.param||n),!1)}}),e,o;return f?(h.addClass(u+"open-dropdown"),e=u+"dropdown",o=r("<div/>",{"class":n+"-"+e+" "+e+" "+u+"fixed-top"}),r.each(f,function(n,t){i.o.btnsDef[t]&&i.isSupportedBtn(t)&&o.append(i.buildSubBtn(t))}),i.$box.append(o.hide())):t.key&&(i.keys[t.key]={func:t.func||n,param:t.param||n}),h},buildSubBtn:function(n){var i=this,t=i.o.btnsDef[n];return t.key&&(i.keys[t.key]={func:t.func||n,param:t.param||n}),r("<button/>",{type:"button","class":i.o.prefix+n+"-dropdown-button"+(t.ico?" "+i.o.prefix+t.ico+"-button":""),text:t.text||t.title||i.lang[n]||n,title:t.key?" (Ctrl + "+t.key+")":null,style:t.style||null,mousedown:function(){return r("body",i.doc).trigger("mousedown"),i.execCmd(t.func||n,t.param||n),!1}})},buildRightBtn:function(n){var t=this.lang[n];return r("<button/>",{type:"button","class":this.o.prefix+n+"-button",title:t,text:t,tabindex:-1})},isSupportedBtn:function(n){try{return this.o.btnsDef[n].isSupported()}catch(t){}return!0},buildOverlay:function(){var n=this;return n.$overlay=r("<div/>",{"class":n.o.prefix+"overlay"}).css({top:n.$btnPane.outerHeight(),height:n.$ed.outerHeight()+1+"px"}).appendTo(n.$box),n.$overlay},showOverlay:function(){var n=this;r(t).trigger("scroll");n.$overlay.fadeIn(200);n.$box.addClass(n.o.prefix+"box-blur")},hideOverlay:function(){var n=this;n.$overlay.fadeOut(50);n.$box.removeClass(n.o.prefix+"box-blur")},fixedBtnPaneEvents:function(){var n=this,u=n.o.fixedFullWidth,i=n.$box;if(n.o.fixedBtnPane){n.isFixed=!1;r(t).on("scroll resize",function(){if(i){n.syncCode();var e=r(t).scrollTop(),o=i.offset().top+1,f=n.$btnPane,s=f.outerHeight();e-o>0&&e-o-n.height<0?(n.isFixed||(n.isFixed=!0,f.css({position:"fixed",top:0,left:u?"0":"auto",zIndex:7}),r([n.$ta,n.$ed]).css({marginTop:f.height()})),f.css({width:u?"100%":i.width()-1+"px"}),r("."+n.o.prefix+"fixed-top",i).css({position:u?"fixed":"absolute",top:u?s:s+(e-o)+"px",zIndex:15})):n.isFixed&&(n.isFixed=!1,f.removeAttr("style"),r([n.$ta,n.$ed]).css({marginTop:0}),r("."+n.o.prefix+"fixed-top",i).css({position:"absolute",top:s}))}})}},destroy:function(){var n=this,t=n.o.prefix,i=n.height;n.isTextarea?n.$box.after(n.$ta.css({height:i}).val(n.html()).removeClass(t+"textarea").show()):n.$box.after(n.$ed.css({height:i}).removeClass(t+"editor").removeAttr("contenteditable").html(n.html()).show());n.$box.remove();n.$c.removeData("trumbowyg")},empty:function(){this.$ta.val("");this.syncCode(!0)},toggle:function(){var n=this,t=n.o.prefix;n.semanticCode(!1,!0);setTimeout(function(){n.$box.toggleClass(t+"editor-hidden "+t+"editor-visible");n.$btnPane.toggleClass(t+"disable");r("."+t+"viewHTML-button",n.$btnPane).toggleClass(t+"active");n.$box.hasClass(t+"editor-visible")?n.$ta.attr("tabindex",-1):n.$ta.removeAttr("tabindex")},0)},dropdown:function(n){var i=this,f=i.doc,u=i.o.prefix,o=r("."+n+"-"+u+"dropdown",i.$box),s=r("."+u+n+"-button",i.$btnPane),e;if(o.is(":hidden")){e=s.offset().left;s.addClass(u+"active");o.css({position:"absolute",top:i.$btnPane.outerHeight(),left:i.o.fixedFullWidth&&i.isFixed?e+"px":e-i.$btnPane.offset().left+"px"}).show();r(t).trigger("scroll");r("body",f).on("mousedown",function(){r("."+u+"dropdown",f).hide();r("."+u+"active",f).removeClass(u+"active");r("body",f).off("mousedown")})}else r("body",f).trigger("mousedown")},html:function(n){var t=this;return n?(t.$ta.val(n),t.syncCode(!0),t):t.$ta.val()},syncCode:function(n){var t=this;!n&&t.$ed.is(":visible")?(t.$ta.val(t.$ed.html()),t.$c.trigger("tbwchange")):t.$ed.html(t.$ta.val());t.o.autogrow&&(t.height=t.$ed.height(),t.height!=t.$ta.css("height")&&(t.$ta.css({height:t.height}),t.$c.trigger("tbwresize")))},semanticCode:function(n,t){var i=this,u,e,f;i.syncCode(n);i.saveSelection();i.o.tagsToRemove.length>0&&r(i.o.tagsToRemove.join(", "),i.$ed).remove();i.o.semantic&&(i.semanticTag("b","strong"),i.semanticTag("i","em"),i.semanticTag("strike","del"),t&&(u=i.o.inlineElementsSelector,e=":not("+i.o.inlineElementsSelector+")",i.$ed.contents().filter(function(){return this.nodeType===3&&r.trim(this.nodeValue).length>0}).wrap("<span data-trumbowyg-textnode/>"),f=function(n){var t,i;n.length!==0&&(t=n.nextUntil(e).andSelf().wrapAll("<p/>").parent(),t.next("br").remove(),i=t.nextAll(u).first(),i.length&&f(i))},f(i.$ed.children(u).first()),i.semanticTag("div","p",!0),i.$ed.find("p").filter(function(){return i.selection&&this===i.selection.startContainer?!1:r(this).text().trim().length===0&&r(this).children().not("br, span").length===0}).contents().unwrap(),r("[data-trumbowyg-textnode]",i.$ed).contents().unwrap(),i.$ed.find("p:empty").replaceWith("<br/>")),i.restoreSelection(),i.$ta.val(i.$ed.html()))},semanticTag:function(n,t,i){r(n,this.$ed).each(function(){var n=r(this);n.wrap("<"+t+"/>");i&&r.each(n.prop("attributes"),function(){n.parent().attr(this.name,this.value)});n.contents().unwrap()})},createLink:function(){var n=this;n.saveSelection();n.openModalInsert(n.lang.createLink,{url:{label:"URL",required:!0},title:{label:n.lang.title},text:{label:n.lang.text,value:n.getSelectedText()},target:{label:n.lang.target}},function(t){var i=r(['<a href="',t.url,'">',t.text,"<\/a>"].join(""));return t.title.length>0&&i.attr("title",t.title),t.target.length>0&&i.attr("target",t.target),n.selection.deleteContents(),n.selection.insertNode(i.get(0)),n.restoreSelection(),!0})},insertImage:function(){var n=this;n.saveSelection();n.openModalInsert(n.lang.insertImage,{url:{label:"URL",required:!0},alt:{label:n.lang.description,value:n.getSelectedText()}},function(t){return n.execCmd("insertImage",t.url),r('img[src="'+t.url+'"]:not([alt])',n.$box).attr("alt",t.alt),!0})},execCmd:function(t,i){var r=this;t!="dropdown"&&r.$ed.focus();try{r[t](i)}catch(u){try{t(i,r)}catch(f){t=="insertHorizontalRule"?i=null:t=="formatBlock"&&(n.userAgent.indexOf("MSIE")!==-1||n.appVersion.indexOf("Trident/")!==-1)&&(i="<"+i+">");r.doc.execCommand(t,!1,i)}}t!="dropdown"&&r.syncCode()},openModal:function(n,i){var u=this,f=u.o.prefix,e,s,o;if(r("."+f+"modal-box",u.$box).length>0)return!1;u.saveSelection();u.showOverlay();u.$btnPane.addClass(f+"disable");e=r("<div/>",{"class":f+"modal "+f+"fixed-top"}).css({top:u.$btnPane.height()+1+"px"}).appendTo(u.$box);u.$overlay.one("click",function(){return e.trigger(f+"cancel"),!1});return s=r("<form/>",{action:"",html:i}).on("submit",function(){return e.trigger(f+"confirm"),!1}).on("reset",function(){return e.trigger(f+"cancel"),!1}),o=r("<div/>",{"class":f+"modal-box",html:s}).css({top:"-"+u.$btnPane.outerHeight()+"px",opacity:0}).appendTo(e).animate({top:0,opacity:1},100),r("<span/>",{text:n,"class":f+"modal-title"}).prependTo(o),e.height(o.outerHeight()+10),r("input:first",o).focus(),u.buildModalBtn("submit",o),u.buildModalBtn("reset",o),r(t).trigger("scroll"),e},buildModalBtn:function(n,t){var i=this,u=i.o.prefix;return r("<button/>",{"class":u+"modal-button "+u+"modal-"+n,type:n,text:i.lang[n]||n}).appendTo(r("form",t))},closeModal:function(){var n=this,i=n.o.prefix,t;n.$btnPane.removeClass(i+"disable");n.$overlay.off();t=r("."+i+"modal-box",n.$box);t.animate({top:"-"+t.height()},100,function(){t.parent().remove();n.hideOverlay()});n.restoreSelection()},openModalInsert:function(n,t,i){var u=this,f=u.o.prefix,e=u.lang,o="";r.each(t,function(n,t){var i=t.label,r=t.name||n;o+='<label><input type="'+(t.type||"text")+'" name="'+r+'" value="'+(t.value||"")+'"><span class="'+f+'input-infos"><span>'+(i?e[i]?e[i]:i:e[n]?e[n]:n)+"<\/span><\/span><\/label>"});return u.openModal(n,o).on(f+"confirm",function(){var o=r("form",r(this)),e=!0,n={};r.each(t,function(t,i){var f=r('input[name="'+t+'"]',o);n[t]=r.trim(f.val());i.required&&n[t]===""?(e=!1,u.addErrorOnModalField(f,u.lang.required)):i.pattern&&!i.pattern.test(n[t])&&(e=!1,u.addErrorOnModalField(f,i.patternError))});e&&(u.restoreSelection(),i(n,t)&&(u.syncCode(),u.closeModal(),r(this).off(f+"confirm")))}).one(f+"cancel",function(){r(this).off(f+"confirm");u.closeModal()})},addErrorOnModalField:function(n,t){var i=this.o.prefix,u=n.parent();n.on("change keyup",function(){u.removeClass(i+"input-error")});u.addClass(i+"input-error").find("input+span").append(r("<span/>",{"class":i+"msg-error",text:t}))},saveSelection:function(){var n=this,i=n.doc.selection,t;n.selection=null;n.doc.getSelection?(t=n.doc.getSelection(),t.getRangeAt&&t.rangeCount&&(n.selection=t.getRangeAt(0))):i&&i.createRange&&(n.selection=i.createRange())},restoreSelection:function(){var n=this,t=n.selection,i;if(t)if(n.doc.getSelection){i=n.doc.getSelection();try{i.removeAllRanges()}catch(r){}i.addRange(t)}else n.doc.selection&&t.select&&t.select()},getSelectedText:function(){var n=this.selection;return n.text!==u?n.text:n+""}}}(navigator,window,document,jQuery);
//# sourceMappingURL=trumbowyg.min.js.map
